{% extends "index.html" %}
{% block body %}
<!-- Barra de progreso prueba general -->
<div class="row">
  <br />
  <div class="col-md-10 col-xs-10 col-md-offset-1 col-xs-offset-1">
    <div class="progress">
      <div class="one no-color col-md-offset-1 col-xs-offset-1"></div>
      <div class="two no-color col-md-offset-1 col-xs-offset-1"></div>
      <div class="three no-color col-md-offset-1 col-xs-offset-1"></div>
      <div class="four no-color col-md-offset-1 col-xs-offset-1"></div>
      <div class="five no-color col-md-offset-1 col-xs-offset-1"></div>
      <div id="general-test-progress-bar" class="progress-bar" style="width: 0%;"></div>
    </div>
  </div>
</div>

<!-- Pasos de la prueba -->
<div class="row">
  <div class="col-sm-6 col-sm-offset-3 form-box">
    <form role="form" action="" method="post" class="registration-form">

      <!-- Paso 1 -->
      <fieldset>
        <div class="form-top">
          <div class="form-top-left">
            <h3>Paso 1 / 5</h3>
            <p>Tipo de Conexión:</p>
          </div>
          <div class="form-top-right">
            <i class="fa fa-wrench"></i>
          </div>
          <div class="form-main">
            <p>Identifique su método de conexión (wifi, 3G, cableada)</p>
            <div class="text-center">
              <div id="alert-box" class="alert alert-info fade in hide">
                Asegurese de seleccionar un <strong>tipo de conexión</strong>.
              </div>
              <div class="btn-group" data-toggle="buttons">
                <label class="btn btn-default icon-selector-button">
                <input type="radio" name="user_conn_type" value="wired" /> <i class="fa fa-compress icon-selector"></i> <br>Cableada
                </label>
                <label class="btn btn-default icon-selector-button">
                <input type="radio" name="user_conn_type" value="wifi" /> <i class="fa fa-wifi icon-selector"></i> <br>Wi-Fi
                </label>
                <label class="btn btn-default icon-selector-button">
                <input type="radio" name="user_conn_type" value="mobile" /> <i class="fa fa-mobile icon-selector"></i> <br>Móvil
                </label>
              </div>
            </div>


<br>
national_server
<select class="form-control" id="national_server">
</select>
<br>
international_server
<select class="form-control" id="international_server">
</select>

          </div>
        </div>
        <div class="form-bottom">
          <button type="button" class="btn btn-next">Comenzar</button>
        </div>
      </fieldset>

      <!-- Paso 2 -->
      <fieldset>
        <div class="form-top">
          <div class="form-top-left">
            <h3>Paso 2 / 5</h3>
            <p>Obtención de Geodata</p>
          </div>
          <div class="form-top-right">
            <i class="fa fa-circle-o-notch fa-spin"></i>
          </div>
          <div class="form-main">
            <p>Recuperando su ubicación</p>
            <center>
              <div id="mapholder"></div>
            </center>
          </div>
        </div>
        <div class="form-bottom"></div>
      </fieldset>

      <!-- Paso 3 -->
      <fieldset>
        <div class="form-top">
          <div class="form-top-left">
            <h3>Paso 3 / 5</h3>
            <p>Evaluación Nacional:</p>
          </div>
          <div class="form-top-right">
            <i class="fa fa-circle-o-notch fa-spin"></i>
          </div>
          <div class="form-main">
            <p>Analizando su velocidad de descarga en enlaces nacionales</p>
            <div class="progress" id="local_test_progress_bar" style="display: initial;">
              <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
                0%
              </div>
            </div>
          </div>
        </div>
        <div class="form-bottom">
        </div>
      </fieldset>

      <!-- Paso 4 -->
      <fieldset>
        <div class="form-top">
          <div class="form-top-left">
            <h3>Paso 4 / 5</h3>
            <p>Evaluación Internacional:</p>
          </div>
          <div class="form-top-right">
            <i class="fa fa-circle-o-notch fa-spin"></i>
          </div>
          <div class="form-main">
            <p>Analizando su velocidad de descarga en enlaces internacionales</p>
            <div class="progress" id="international_test_progress_bar" style="display: initial;">
              <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
                0%
              </div>
            </div>
          </div>
        </div>
        <div class="form-bottom">
        </div>
      </fieldset>

      <!-- Paso 5 -->
      <fieldset>
        <div class="form-top">
          <div class="form-top-left">
            <h3>Paso 5 / 5</h3>
            <p>Tiempos de Conectividad:</p>
          </div>
          <div class="form-top-right">
            <i class="fa fa-circle-o-notch fa-spin"></i>
          </div>
          <div class="form-main">
            <p>Evaluando conectividad </p>
            <table class="table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Sitio</th>
                </tr>
              </thead>
              <tbody id="ping_list_sites">
              </tbody>
            </table>
          </div>
        </div>
        <div class="form-bottom">
        </div>
      </fieldset>

      <!-- Paso 6 DEBE SER BORRADO PARA VALIDAR EN SERVIDOR!-->
      <fieldset>
        <div class="form-top">
          <div class="form-top-left">
            <h3>Completado análisis locales</h3>
            <p>Detalles colectados:</p>
          </div>
          <div class="form-top-right">
            <i class="fa fa-check"></i>
          </div>
        </div>
        <div class="row">
          <div class="form-main" style="text-align: justify;"></div>
        </div>
        <div class="form-bottom"></div>
      </fieldset>
      <input type="hidden" value="0" id="step_counter" >
    </form>
  </div>
</div>
{% endblock %}

{% block customJS %}
<!-- Otros -->
<script src="{{ url_for('static', filename='NetworkInformation-Library/StaticInformation.js') }}"></script>
<script src="{{ url_for('static', filename='NetworkInformation-Library/NetworkUtilities.js') }}"></script>
<script src="{{ url_for('static', filename='NetworkInformation-Library/NetworkInformation.js') }}"></script>
<script src="{{ url_for('static', filename='NetworkInformation-Library/SpeedTest.js') }}"></script>
<script src="{{ url_for('static', filename='NetworkInformation-Library/Heimdal.js') }}"></script>
<script src="{{ url_for('static', filename='NetworkInformation-Library/ExternalJavascript/detectSpeed.js') }}"></script>
<!-- Google -->
<script src="http://maps.google.com/maps/api/js?key=AIzaSyCFDF69-o9nKmtHYlVe4LnS6vGrf7fTuCc"></script>


<!-- Inicialización de valores para el examen -->
<script type="text/javascript">
  var file_international = "";
  var file_national = "";
  var heimdal = new Heimdal('http://127.0.0.1:5000/echo');


  $( "#national_server" ).change(function() {
    file_national = $( "#national_server" ).val() +  "speedtest/10";
  });

  $( "#international_server" ).change(function() {
    file_international = $( "#international_server" ).val() +  "speedtest/10";
  });


  function getRemote(remote_url) {
    return $.ajax({
      type: "GET",
      cache: false,
      url: remote_url,
      async: false,
      timeout: 3000
    }).status;
  }

  $( document ).ready(function() {
    console.log( "ready to make requests" );
    $.post( "{{main_server}}activeServers/", function( data ) {
      var lista = [];
      $.each(data.data, function(i, field){
        if (getRemote(field.url) == 200) {
          lista.push(field.url);
          console.log(field.url + " added");
        }
      });

      $.each(lista, function (i, item) {
        $('#national_server').append($('<option>', {
          value: item,
          text : item
        }));
        $('#international_server').append($('<option>', {
          value: item,
          text : item
        }));
      });

    }, 'json');

  });



</script>
{% endblock %}
